# 用户故事自动化实现工作流

> **工作流 ID**: story-implementation
> **触发命令**: `*story-implementation`
> **智能体**: Phoenix (全自动化迭代开发编排器)
> **说明**: 本工作流是 `full-auto-workflow` 的后半部分，专注于用户故事的完整生命周期自动化实现

---

## 工作流概述

本工作流实现用户故事从创建到测试验证的完整生命周期自动化，融合 SM、DEV、TEA 三大智能体能力。**每个故事必须完成全部 5 步后才能开始下一个故事**。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       用户故事自动化实现流程                               │
├─────────────────────────────────────────────────────────────────────────┤
│  前置条件 (由 requirement-to-epic-workflow 产出)                         │
│  ├─ epics/epic-XXX.md (史诗和故事定义)                                   │
│  ├─ architecture.md (架构设计文档)                                       │
│  └─ prd.md (产品需求文档)                                               │
├─────────────────────────────────────────────────────────────────────────┤
│  Step 0: Sprint 规划 [SM 能力]                                          │
│  ├─ 唤醒命令: /sm                                                       │
│  ├─ 执行命令: *sprint-planning                                          │
│  └─ 输出: sprint-status.yaml                                            │
├─────────────────────────────────────────────────────────────────────────┤
│  🔄 For Each Story 完整生命周期循环:                                      │
│  │                                                                       │
│  │  STEP 1: 创建用户故事 [SM - Bob]                                      │
│  │  ├─ 命令: /sm → *create-story                                        │
│  │  ├─ 状态: backlog → drafted                                          │
│  │  └─ 输出: /sprint-artifacts/stories/{story-key}.md                   │
│  │                                                                       │
│  │  STEP 2: 校验用户故事 [SM - Bob]                                      │
│  │  ├─ 命令: /sm → *validate-create-story                               │
│  │  └─ 状态: drafted → ready-for-dev                                    │
│  │                                                                       │
│  │  STEP 3: 开发用户故事 [DEV - Amelia]                                  │
│  │  ├─ 命令: /dev → *develop-story                                      │
│  │  ├─ 执行: TDD 驱动开发 (红-绿-重构)                                   │
│  │  └─ 状态: ready-for-dev → in-progress                                │
│  │                                                                       │
│  │  STEP 4: 代码审查 [DEV - Amelia]                                      │
│  │  ├─ 命令: /dev → *code-review                                        │
│  │  ├─ 结果: APPROVED → 继续 / CHANGES_REQUESTED → 返回 STEP 3          │
│  │  └─ 状态: in-progress → review                                       │
│  │                                                                       │
│  │  STEP 5: 测试验证 [TEA - Murat]                                       │
│  │  ├─ 命令: /tea → *trace + *test-review                               │
│  │  ├─ 结果: PASS → done / FAIL → 返回 STEP 3                           │
│  │  └─ 状态: review → done                                              │
│  │                                                                       │
│  └─ ✅ 故事完成 → 🔄 返回 STEP 1 开始下一个故事                           │
├─────────────────────────────────────────────────────────────────────────┤
│  输出                                                                    │
│  ├─ 实现的代码                                                          │
│  ├─ 测试代码                                                            │
│  ├─ 每个故事的验证报告                                                   │
│  └─ sprint-status.yaml (已更新)                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 智能体命令汇总表

| 步骤 | 智能体 | 唤醒命令 | 核心工作流命令 | 用途 | 状态变更 |
|------|--------|---------|---------------|------|----------|
| Step 0 | Bob (SM) | `/sm` | `*sprint-planning` | Sprint 规划 | - |
| STEP 1 | Bob (SM) | `/sm` | `*create-story` | 创建故事文件 | backlog→drafted |
| STEP 2 | Bob (SM) | `/sm` | `*validate-create-story` | 校验故事 | drafted→ready-for-dev |
| STEP 3 | Amelia (DEV) | `/dev` | `*develop-story` | TDD 开发 | ready-for-dev→in-progress |
| STEP 4 | Amelia (DEV) | `/dev` | `*code-review` | 代码审查 | in-progress→review |
| STEP 5 | Murat (TEA) | `/tea` | `*trace` + `*test-review` | 测试验证 | review→done |

---

## 故事状态系统 (6状态流转)

```
backlog → drafted → ready-for-dev → in-progress → review → done
   │         │            │              │           │       │
   │         │            │              │           │       └─ 故事完成
   │         │            │              │           └─ 等待测试验证
   │         │            │              └─ 开发进行中
   │         │            └─ 可以开始开发
   │         └─ 故事文件已创建
   └─ 仅存在于 Epic 文件中
```

---

## ⛔ 强制性执行约束 (MANDATORY CONSTRAINTS)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                    🚨 绝对禁止 - ABSOLUTELY FORBIDDEN 🚨                       ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  1. ❌ 禁止跳过故事文件创建                                                    ║
║     - 绝对禁止直接基于 Epic 进行开发                                           ║
║     - 每个故事必须先创建独立的故事文件到 /sprint-artifacts/stories/ 目录        ║
║     - 没有故事文件 = 不允许开发                                                ║
║                                                                               ║
║  2. ❌ 禁止跳过故事验证                                                        ║
║     - 故事文件创建后必须执行 *validate-create-story 验证                       ║
║     - 验证未通过 = 不允许进入开发阶段                                          ║
║                                                                               ║
║  3. ❌ 禁止跳过单元测试                                                        ║
║     - 开发完成后必须执行单元测试                                               ║
║     - 测试未通过 = 不允许进入代码审查阶段                                       ║
║                                                                               ║
║  4. ❌ 禁止跳过代码审查                                                        ║
║     - 所有代码必须通过 *code-review 审查                                       ║
║     - 审查未通过 = 必须返回修复                                                ║
║                                                                               ║
║  5. ❌ 禁止跳过测试验证                                                        ║
║     - 代码审查通过后必须执行 TEA 测试验证                                       ║
║     - 测试验证未通过 = 必须返回修复                                             ║
║                                                                               ║
║  6. ❌ 禁止批量处理多个故事                                                    ║
║     - 必须一个故事一个故事地完成                                               ║
║     - 当前故事未完成 = 不允许开始下一个故事                                     ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

## 执行指令

当用户输入 `*story-implementation` 时，按以下流程自动执行：

### Step 0: Sprint 规划

**角色激活**: SM (Bob)

```
┌─────────────────────────────────────────────────────────────────┐
│  Step 0: Sprint 规划                                             │
│  智能体: Bob (SM)                                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 唤醒 SM 智能体                                               │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: /sm                                           │ │
│     │ 说明: 唤醒 Scrum Master Bob，准备进行 Sprint 规划        │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 执行 Sprint 规划工作流                                       │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *sprint-planning                              │ │
│     │ 说明: 分析 Epic 文件，生成 sprint-status.yaml           │ │
│     │ 输入: epics/*.md                                        │ │
│     │ 输出: sprint-status.yaml                                │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 门禁检查: sprint-status.yaml 必须存在才能继续                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**执行命令**:
```bash
# 唤醒 SM 智能体
/sm

# 执行 Sprint 规划
*sprint-planning

# 🚨 门禁检查: 确认 sprint-status.yaml 已生成
ls {sprint_artifacts}/sprint-status.yaml
```

---

### 🔄 故事完整生命周期循环

> ⚠️ **强制要求**: 对于 sprint-status.yaml 中的每一个故事，必须严格按以下 5 步流程执行，当前故事完成后才能开始下一个故事！

---

#### STEP 1: 创建用户故事 [必须]

**角色激活**: SM (Bob)

```
┌─────────────────────────────────────────────────────────────────┐
│  🔴 STEP 1: 创建用户故事 [必须]                                   │
│  智能体: Bob (SM)                                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  执行步骤:                                                        │
│                                                                  │
│  1. 唤醒 SM 智能体                                               │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: /sm                                           │ │
│     │ 说明: 唤醒 Scrum Master Bob，准备创建故事文件            │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 🔴 创建故事文件 [必须]                                        │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *create-story                                 │ │
│     │ 说明: 从 Epic 中提取故事定义，创建独立的故事文件          │ │
│     │ 输入: sprint-status.yaml + epics/*.md                   │ │
│     │ 输出: /sprint-artifacts/stories/{story-key}.md          │ │
│     │ 状态: backlog → drafted                                 │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 门禁检查 (GATE 1):                                            │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 必须验证故事文件已创建                                 │ │
│     │ ls -la {sprint_artifacts}/stories/{story-key}.md       │ │
│     │                                                         │ │
│     │ ❌ 如果文件不存在：禁止继续！必须先创建故事文件！         │ │
│     │ ✅ 如果文件存在：可以进入 STEP 2                         │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**执行命令**:
```bash
# 唤醒 SM 智能体
/sm

# 🔴 [必须] 创建故事文件
*create-story

# 🚨 门禁检查：验证故事文件已创建
ls -la {sprint_artifacts}/stories/{story-key}.md
```

---

#### STEP 2: 校验用户故事 [必须]

**角色激活**: SM (Bob)

```
┌─────────────────────────────────────────────────────────────────┐
│  🔴 STEP 2: 校验用户故事 [必须]                                   │
│  智能体: Bob (SM)                                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  前置条件检查:                                                    │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 验证故事文件存在且状态为 drafted                       │ │
│     │ grep "Status: drafted" {sprint_artifacts}/stories/*.md  │ │
│     │                                                         │ │
│     │ ❌ 如果没有 drafted 状态的故事：返回 STEP 1              │ │
│     │ ✅ 如果存在：继续执行验证                                │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  执行步骤:                                                        │
│                                                                  │
│  1. 唤醒 SM 智能体                                               │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: /sm                                           │ │
│     │ 说明: 唤醒 Scrum Master Bob，准备验证故事                │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 🔴 验证故事文件 [必须]                                        │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *validate-create-story                        │ │
│     │ 验证内容:                                                │ │
│     │   - 接受标准完整性 (Given-When-Then)                    │ │
│     │   - 任务分解合理性                                       │ │
│     │   - 技术说明充分性                                       │ │
│     │ 状态: drafted → ready-for-dev                           │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 门禁检查 (GATE 2):                                            │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 验证故事状态已更新为 ready-for-dev                     │ │
│     │ grep "Status: ready-for-dev" {story-file}              │ │
│     │                                                         │ │
│     │ ❌ 验证未通过：返回 STEP 1 修正故事                       │ │
│     │ ✅ 验证通过：可以进入 STEP 3                              │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**执行命令**:
```bash
# 唤醒 SM 智能体
/sm

# 🔴 [必须] 验证故事文件
*validate-create-story

# 🚨 门禁检查：验证故事状态已更新
grep "Status: ready-for-dev" {sprint_artifacts}/stories/{story-key}.md
```

---

#### STEP 3: 开发用户故事 [必须]

**角色激活**: DEV (Amelia)

```
┌─────────────────────────────────────────────────────────────────┐
│  🔴 STEP 3: 开发用户故事 [必须]                                   │
│  智能体: Amelia (DEV)                                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  前置条件检查 (强制!):                                            │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 🚨 必须验证故事文件存在且状态为 ready-for-dev          │ │
│     │ ls {sprint_artifacts}/stories/{story-key}.md           │ │
│     │ grep "Status: ready-for-dev" {story-file}              │ │
│     │                                                         │ │
│     │ ❌ 如果故事文件不存在：禁止开发！返回 STEP 1            │ │
│     │ ❌ 如果状态不是 ready-for-dev：返回 STEP 1-2            │ │
│     │ ✅ 如果存在且状态正确：继续开发                          │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  执行步骤:                                                        │
│                                                                  │
│  1. 唤醒 DEV 智能体                                              │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: /dev                                          │ │
│     │ 说明: 唤醒开发者 Amelia，准备进行 TDD 开发               │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 🔴 执行故事开发工作流 [必须]                                  │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *develop-story                                │ │
│     │ 说明: 基于故事文件执行 TDD 驱动开发                      │ │
│     │ 执行流程:                                                │ │
│     │   - TDD 实现 (红-绿-重构)                                │ │
│     │   - 编写全面测试                                         │ │
│     │   - 运行验证和测试                                       │ │
│     │ 状态: ready-for-dev → in-progress                       │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 关键规则:                                                     │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ ❌ 禁止基于 Epic 直接开发！必须基于 Story 文件！             │ │
│  │ ✅ 故事文件是唯一的事实来源                                  │ │
│  │ ✅ 严格按照 Tasks/Subtasks 顺序执行                          │ │
│  │ ✅ 每个任务完成前必须有测试覆盖                              │ │
│  │ ✅ 所有单元测试必须 100% 通过                                │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**执行命令**:
```bash
# 🚨 前置检查：验证故事文件存在
ls {sprint_artifacts}/stories/{story-key}.md
grep "Status: ready-for-dev" {sprint_artifacts}/stories/{story-key}.md

# 唤醒 DEV 智能体
/dev

# 🔴 [必须] 执行故事开发 (基于故事文件！)
*develop-story
```

**TDD 执行流程**:
```
For Each Task in Story:
  1. 🔴 编写测试 (Red Phase)
     - 根据接受标准编写测试用例
     - 运行测试，确认失败

  2. 🟢 实现代码 (Green Phase)
     - 编写最小代码使测试通过
     - 运行测试，确认通过

  3. 🔵 重构 (Refactor Phase)
     - 优化代码结构
     - 确保测试仍然通过

  4. ✅ 标记任务完成
```

---

#### STEP 4: 代码审查 [必须]

**角色激活**: DEV (Amelia)

```
┌─────────────────────────────────────────────────────────────────┐
│  🔴 STEP 4: 代码审查 [必须]                                       │
│  智能体: Amelia (DEV)                                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  前置条件检查:                                                    │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 验证故事状态为 in-progress 且单元测试已通过            │ │
│     │ grep "Status: in-progress" {story-file}                │ │
│     │                                                         │ │
│     │ ❌ 如果状态不是 in-progress：返回 STEP 3                 │ │
│     │ ✅ 如果状态正确且测试通过：继续执行代码审查              │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  执行步骤:                                                        │
│                                                                  │
│  1. 唤醒 DEV 智能体 (建议全新上下文)                              │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: /dev                                          │ │
│     │ 建议: 使用全新上下文和不同 LLM 以获得更客观的评估        │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 🔴 执行代码审查工作流 [必须]                                  │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *code-review                                  │ │
│     │ 审查维度:                                                │ │
│     │   - 功能正确性: 是否满足所有接受标准                     │ │
│     │   - 代码质量: 清晰可读、命名规范、遵循项目规范           │ │
│     │   - 安全性: 注入风险、敏感数据处理、认证授权             │ │
│     │   - 测试覆盖: 测试充分性、边界情况覆盖                   │ │
│     │ 状态: in-progress → review                              │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 审查结果处理:                                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ APPROVED (通过):                                        │ │
│     │   - 状态更新为 review                                   │ │
│     │   - 继续到 STEP 5 (测试验证)                            │ │
│     │                                                         │ │
│     │ CHANGES_REQUESTED (需修改):                             │ │
│     │   - 返回 STEP 3 修复问题                                 │ │
│     │   - 修复后重新执行 STEP 3-4                              │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**执行命令**:
```bash
# 唤醒 DEV 智能体 (建议全新上下文)
/dev

# 🔴 [必须] 执行代码审查
*code-review

# 🚨 门禁检查：
# - APPROVED: 继续到 STEP 5 (测试验证)
# - CHANGES_REQUESTED: 返回 STEP 3 修复
```

---

#### STEP 5: 测试验证 [必须]

**角色激活**: TEA (Murat)

```
┌─────────────────────────────────────────────────────────────────┐
│  🔴 STEP 5: 测试验证 [必须] - 故事生命周期最后一步               │
│  智能体: Murat (TEA)                                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  前置条件检查:                                                    │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 验证故事状态为 review 且代码审查已通过                 │ │
│     │ grep "Status: review" {story-file}                     │ │
│     │                                                         │ │
│     │ ❌ 如果状态不是 review：返回 STEP 4 完成代码审查         │ │
│     │ ✅ 如果状态正确：继续执行测试验证                        │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  执行步骤:                                                        │
│                                                                  │
│  1. 唤醒 TEA 智能体                                              │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: /tea                                          │ │
│     │ 说明: 唤醒测试架构师 Murat，准备进行测试验证             │ │
│     │ 建议: 使用全新上下文以获得更客观的测试评估               │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 🔴 执行需求追溯验证 [必须]                                    │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *trace                                        │ │
│     │ 验证内容:                                                │ │
│     │   - 需求覆盖: 每个接受标准都有对应的代码实现             │ │
│     │   - 测试覆盖: 每个接受标准都有对应的测试用例             │ │
│     │   - 追溯完整: 需求 ↔ 代码 ↔ 测试 三向追溯                │ │
│     │   - 无遗漏: 没有未实现的需求项                           │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  3. 🔴 执行测试质量评审 [必须]                                    │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ 执行命令: *test-review                                  │ │
│     │ 评审维度:                                                │ │
│     │   - 测试充分性: 测试用例是否覆盖所有场景                 │ │
│     │   - 边界测试: 边界条件和异常情况是否测试                 │ │
│     │   - 测试质量: 断言是否明确、测试是否独立                 │ │
│     │   - 集成测试: 模块间交互是否验证                         │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 验证结果处理:                                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ PASS (通过):                                            │ │
│     │   - 状态: review → done                                 │ │
│     │   - 故事完成！处理下一个故事                             │ │
│     │                                                         │ │
│     │ FAIL (失败):                                            │ │
│     │   - 状态: review → in-progress                          │ │
│     │   - 返回 STEP 3 修复问题                                 │ │
│     │   - 修复后重新执行 STEP 3-5                              │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
│  🚨 门禁检查 (GATE 5 - 最终门禁):                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │ # 故事完成验证                                           │ │
│     │ 1. 需求追溯完整 (*trace 通过)                           │ │
│     │ 2. 测试质量达标 (*test-review 通过)                     │ │
│     │ 3. 所有测试 100% 通过                                   │ │
│     │ 4. 故事状态已更新为 done                                 │ │
│     │                                                         │ │
│     │ ❌ 验证未通过：返回 STEP 3 修复                           │ │
│     │ ✅ 验证通过：故事完成，处理下一个故事                     │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**执行命令**:
```bash
# 🚨 前置检查：验证故事状态为 review
grep "Status: review" {sprint_artifacts}/stories/{story-key}.md

# 唤醒 TEA 智能体 (建议全新上下文)
/tea

# 🔴 [必须] 执行需求追溯验证
*trace

# 🔴 [必须] 执行测试质量评审
*test-review

# 根据验证结果处理:
# PASS → 故事完成，处理下一个故事
# FAIL → 返回 STEP 3 修复
```

---

## 状态流转图

```
                    STEP 1              STEP 2
              ┌──────────────┐    ┌──────────────┐
  backlog ────│ *create-story │───▶│ *validate    │───▶ ready-for-dev
              │  (SM)         │    │  (SM)        │
              └──────────────┘    └──────────────┘
                                         │
                                         │ STEP 3
                                         ▼
                                  ┌──────────────┐
                                  │ *develop-story│
                                  │  (DEV)        │
                                  └──────────────┘
                                         │
                                         ▼
                                    in-progress
                                         │
                                         │ STEP 4
                                         ▼
                                  ┌──────────────┐
                         ┌────────│ *code-review │────────┐
                         │        │  (DEV)        │        │
                         │        └──────────────┘        │
                         │                                │
                    APPROVED                      CHANGES_REQUESTED
                         │                                │
                         ▼                                │
                      review                              │
                         │                                │
                         │ STEP 5                         │
                         ▼                                │
                  ┌──────────────┐                        │
         ┌───────│ *trace +      │────────┐               │
         │       │ *test-review  │        │               │
         │       │  (TEA)        │        │               │
         │       └──────────────┘        │               │
         │                               │               │
       PASS                            FAIL              │
         │                               │               │
         ▼                               └───────────────┘
       done                                 (返回 STEP 3)
         │
         └───▶ 🔄 返回 STEP 1 开始下一个故事
```

---

## 状态更新操作

每次状态变化时，必须同时更新两个文件：

### 1. sprint-status.yaml

```yaml
development_status:
  1-1-story-name: done        # 原来是 review
  1-2-story-name: in-progress # 当前正在处理的故事
```

### 2. 故事文件

```markdown
# Story: 1-2-story-name

Status: in-progress

## Story
...
```

---

## 与其他工作流的关系

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         工作流关系图                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  requirement-to-epic-workflow     ───▶     story-implementation-workflow│
│  (需求分析到 Epic 生成)                     (用户故事自动化实现)          │
│                                                                         │
│  输出:                                     输入:                         │
│  - PRD                            ◀────── - PRD                         │
│  - Architecture                   ◀────── - Architecture                │
│  - Epics (含故事定义)              ◀────── - Epics                       │
│                                                                         │
│                          OR                                             │
│                                                                         │
│                 full-auto-workflow                                      │
│                 (完整的端到端自动化)                                      │
│                 = requirement-to-epic + story-implementation            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 执行完成

当所有故事完成后，输出完成报告：

```markdown
# 用户故事实现完成报告

## 执行摘要
- **开始时间**: {start_time}
- **完成时间**: {end_time}
- **状态**: ✅ 成功完成

## 故事完成统计
- 总故事数: N
- 已完成: N
- 完成率: 100%

## 产出物
- [x] 实现的代码
- [x] 测试代码
- [x] 每个故事的验证报告
- [x] sprint-status.yaml (已更新)

## 质量指标
- 单元测试: 全部通过
- 代码审查: 全部 APPROVED
- 测试验证: 全部 PASS
```
