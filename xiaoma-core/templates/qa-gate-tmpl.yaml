template:
  id: qa-gate-template-v1
  name: 质量门禁决策
  version: 1.0
  output:
    format: yaml
    filename: qa.qaLocation/gates/{{epic_num}}.{{story_num}}-{{story_slug}}.yml
    title: "Quality Gate: {{epic_num}}.{{story_num}}"

# 必填字段 (置于首部)
schema: 1
story: "{{epic_num}}.{{story_num}}"
story_title: "{{story_title}}"
gate: "{{gate_status}}" # 可选值: PASS|CONCERNS|FAIL|WAIVED
status_reason: "{{status_reason}}" # 关于此门禁决策原因的1-2句话摘要
reviewer: "Quinn (测试架构师)"
updated: "{{iso_timestamp}}"

# 始终存在，但仅在状态为 WAIVED 时激活
waiver: { active: false }

# 问题列表 (如有) - 使用固定严重性: low | medium | high
top_issues: []

# 风险摘要 (如果运行了 risk-profile 任务)
risk_summary:
  totals: { critical: 0, high: 0, medium: 0, low: 0 }
  recommendations:
    must_fix: []
    monitor: []

# 为清晰起见，使用块标量的示例部分
examples:
  with_issues: |
    top_issues:
      - id: "SEC-001"
        severity: high  # 仅限: low|medium|high
        finding: "登录端点上没有速率限制"
        suggested_action: "在生产部署前添加速率限制中间件"
      - id: "TEST-001"  
        severity: medium
        finding: "认证流程缺少集成测试"
        suggested_action: "为关键路径添加测试覆盖"

  when_waived: |
    waiver:
      active: true
      reason: "为 MVP 版本发布而接受 - 将在下个迭代中解决"
      approved_by: "产品负责人"

# ============ 可选扩展字段 ============
# 如果您的团队需要更详细的信息，请取消注释并使用

optional_fields_examples:
  quality_and_expiry: |
    quality_score: 75  # 0-100 (可选评分)
    expires: "2025-01-26T00:00:00Z"  # 可选的门禁有效时间窗口

  evidence: |
    evidence:
      tests_reviewed: 15
      risks_identified: 3
      trace:
        ac_covered: [1, 2, 3]  # 已有测试覆盖的验收标准 (AC) 编号
        ac_gaps: [4]  # 缺少测试覆盖的验收标准 (AC) 编号

  nfr_validation: |
    nfr_validation:
      security: { status: CONCERNS, notes: "缺少速率限制" }
      performance: { status: PASS, notes: "" }
      reliability: { status: PASS, notes: "" }
      maintainability: { status: PASS, notes: "" }

  history: |
    history:  # 只可追加的审计追踪记录
      - at: "2025-01-12T10:00:00Z"
        gate: FAIL
        note: "初次评审 - 缺少测试"
      - at: "2025-01-12T15:00:00Z"  
        gate: CONCERNS
        note: "已添加测试，但仍缺少速率限制"

  risk_summary: |
    risk_summary:  # 来自 risk-profile 任务
      totals:
        critical: 0
        high: 0
        medium: 0
        low: 0
      # 'highest' 仅在存在风险时才会输出
      recommendations:
        must_fix: []
        monitor: []

  recommendations: |
    recommendations:
      immediate:  # 生产环境发布前必须修复
        - action: "为认证端点添加速率限制"
          refs: ["api/auth/login.ts:42-68"]
      future:  # 可在以后解决
        - action: "考虑使用缓存以提高性能"
          refs: ["services/data.service.ts"]
